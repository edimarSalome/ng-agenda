angular.module("angular-agenda",["ngSanitize"]).controller("agendaCtrl",["$scope","$sce","$filter",function(b,a,d){var c=this;c.construct=function(){c.setView("week");c.initAgenda();c.initUsuarios();c.initHorarios();c.initEventos();b.filtroUsuarios={ativo:true}};c.initAgenda=function(){c.setDataAgenda();c.setWeekDays();c.setMonthDays()};b.isDataAgenda=function(e){return b.getDate().isSame(e,"day")};c.setDataAgenda=function(e){c.dataAgenda=e?e:moment()};b.getDate=function(){return c.dataAgenda};c.previous=function(){c.dataAgenda.subtract(1,"days")};c.next=function(){c.dataAgenda.add(1,"days")};c.previousWeek=function(){c.dataAgenda.subtract(1,"weeks");c.setWeekDays()};c.nextWeek=function(){c.dataAgenda.add(1,"weeks");c.setWeekDays()};c.previousMonth=function(){c.dataAgenda.subtract(1,"months");if(b.isView("week")){c.setWeekDays()}else{if(b.isView("month")){c.setMonthDays()}}};c.nextMonth=function(){c.dataAgenda.add(1,"months");if(b.isView("week")){c.setWeekDays()}else{if(b.isView("month")){c.setMonthDays()}}};c.today=function(){c.setDataAgenda();if("week"){c.setWeekDays()}};b.isToday=function(){return b.getDate().isSame(moment(),"day")};b.isTodayWeek=function(){return b.getDate().isSame(moment(),"week")};c.setView=function(e){if(c.activeView&&e==="day"){c.setDataAgenda(c.dataAgenda.startOf(c.activeView))}else{if(e==="week"){c.setWeekDays()}else{if(e==="month"){c.setMonthDays()}}}c.activeView=e==="day"||e==="week"||e==="month"?e:"day"};b.getView=function(){return c.activeView};b.isView=function(e){return c.activeView===e?true:false};c.setWeekDays=function(){var g=moment(b.getDate()).endOf("week");var e=moment(b.getDate()).startOf("week");b.weekDays=[];var f=e;while(f<=g){b.weekDays.push(f);f=f.clone().add(1,"d")}};c.setMonthDays=function(){var f=moment(b.getDate()).endOf("month");var g=moment(b.getDate()).startOf("month");b.monthDays=[];var e=g;c.setWeekFirstDay(g);c.setWeekLastDay(f);while(e<=f){b.monthDays.push(e);e=e.clone().add(1,"d")}};c.setWeekFirstDay=function(e){b.weekFirstDay=e.isoWeekday()};c.setWeekLastDay=function(e){b.weekLastDay=e.isoWeekday()};b.getMonthRepeater=function(e){var h=[];if(e==="start"){for(var g=0;g<(b.weekFirstDay);g++){h.push(g)}}else{var f=b.weekLastDay===7?6:6-b.weekLastDay;for(var g=0;g<(f);g++){h.push(g)}}return h.length===7?0:h};c.setEvents=function(e){c.events=e};c.getEvent=function(e,f){var g=false;angular.forEach(c.events,function(k,j){var i=k.date.format("DDMMYYHHmm")===e.format("DDMMYYHHmm");var h=f?k.user===f.id:true;if(i&&h){g=k}});return g?g:false};c.getEventMonth=function(e,f){var g=0;angular.forEach(c.events,function(k,j){var i=k.date.isSame(e,"day");var h=f?k.user===f.id:true;if(i&&h){g++}});return g?g:false};b.parseDayEvent=function(e,i,f){var g=moment(b.getDate());g.hour(e).minute(i);var h=c.getEvent(g,f);return h?a.trustAsHtml("<div id='"+h.id+"' class='event-view'><span>"+h.name+"</span></div>"):""};b.parseWeekEvent=function(e,h,f){var f=moment(f);f.hour(e).minute(h);var g=c.getEvent(f,0);return g?"<div id='"+g.id+"' class='event-view'><span>"+g.name+"</span></div>":""};b.parseMonthEvent=function(e){var e=moment(e);var f=c.getEventMonth(e,0);return f?"<div class='event-view-month'><span>"+f+" <small>Agendamentos</small></span></div>":""};b.dClick=function(e,h,g,f){c.dataAgenda.hour(e).minute(h);if(f.currentTarget.childNodes.length){c.eventClick(f.currentTarget.childNodes[0].id)}else{c.dayClick(e,h,g)}};b.wClick=function(e,h,g,f){g.hour(e).minute(h);if(f.currentTarget.childNodes.length){c.eventClick(f.currentTarget.childNodes[0].id)}else{c.weekClick(e,h,g)}};c.dayClick=function(e,g,f){alert("Você clicou em "+c.dataAgenda.format()+" do usuário "+f.nome)};c.weekClick=function(e,g,f){alert("Você clicou em "+f.format())};b.monthClick=function(e){c.setView("day");c.setDataAgenda(e)};b.monthClickMobile=function(e){c.setView("week");c.setDataAgenda(e);c.setWeekDays()};c.eventClick=function(e){alert("Clique no evento"+e)};c.initHorarios=function(){b.horas=[{desc:"07"},{desc:"08"},{desc:"09"},{desc:"10"},{desc:"11"}];b.minutos=[{desc:"00"},{desc:"15"},{desc:"30"},{desc:"45"}]};c.initUsuarios=function(){b.usuarios=[{id:1,nome:"Dr. Edimar",ativo:true},{id:2,nome:"Dr. Lauro Miller",ativo:true},{id:3,nome:"Dr. Roger That!",ativo:false}]};c.initEventos=function(){var e=[{id:1,name:"Comprar ingresso FINIT",date:moment().hour(7).minute(30),user:1},{id:2,name:"Gerar relatório do mês",date:moment().hour(8).minute(0),user:1},{id:3,name:"Reunião para marcar outra reunião",date:moment().hour(10).minute(30),user:1},{id:4,name:"Questionar questão",date:moment().hour(9).minute(30),user:2},{id:5,name:"Conferir itens a ser conferidos",date:moment().minute(15).add(1,"days"),user:2}];c.setEvents(e)};c.construct()}]);